#!/bin/bash

cur_date=`date +"%Y%m%d_%H%M%S"`
host=`hostname`

i_arg=0
for arg in "$@"
do
  i_arg=$((i_arg+1))
  if [ ${i_arg} -eq 1 ] ; then
    cmd=${arg}
    cmd_str=`echo ${arg} | sed -e 's/[[:space:]]/_/g'`
  else
    cmd=${cmd}" "${arg}
    cmd_str=${cmd_str}_`echo ${arg} | sed -e 's/[[:space:]]/_/g'`
  fi
done

log_str=${cmd_str}_${cur_date}

if [[ ${cmd_str} =~ "th_" ]] ; then
  cmd=${cmd}" -l "${log_str}".log"
fi

log_stdout=${log_str}.out
log_stderr=${log_str}.err
time_cmd="time ${cmd}"

nohup bash -c "(time ${cmd} > ${log_stdout})" &>> ${log_stderr} < /dev/null &
pid=`echo $!`
echo "run  '${time_cmd}'  on $host  with pid = ${pid}" >> ${log_stderr}
echo "" >> ${log_stderr}

# ps -o pid,ppid | sed -n '/14379/p'
